<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Administrativo</title>
    <meta name="description" content="Sistema administrativo para gesti√≥n de comunicados y solicitudes">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Premium Design System - Single Complete CSS File -->
    <link rel="stylesheet" href="css/premium-design.css">
    <!-- HTML2Canvas for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link">Saltar al contenido principal</a>
    
    <!-- Login Screen (visible by default) -->
    <div id="login-screen" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <img src="assets/logo.png" alt="Logo" class="logo" onerror="this.style.display='none'">
                <h1>Sistema Administrativo</h1>
                <p>Inicie sesi√≥n para continuar</p>
            </div>
            <form id="login-form" class="auth-form">
                <div class="form-group">
                    <label for="login-email">Email <span class="required-indicator">*</span></label>
                    <input type="email" id="login-email" required autocomplete="email" placeholder="tu@email.com">
                </div>
                <div class="form-group">
                    <label for="login-password">Contrase√±a <span class="required-indicator">*</span></label>
                    <input type="password" id="login-password" required autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit" class="btn btn-primary btn-block" aria-label="Iniciar sesi√≥n en el sistema">Iniciar Sesi√≥n</button>
                <div id="login-error" class="error-message"></div>
            </form>
        </div>
    </div>

    <!-- Main Application (hidden by default) -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Header -->
        <header class="header">
            <button class="menu-toggle" id="menu-toggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <h1 class="app-title">Sistema Administrativo</h1>
            <div class="user-menu">
                <span id="user-name" class="user-name"></span>
                <button id="logout-btn" class="btn btn-secondary">Cerrar Sesi√≥n</button>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-text">Sistema Admin</div>
                </div>
                <div class="sidebar-subtitle">Gesti√≥n Integral</div>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item" data-page="dashboard" aria-label="Dashboard - Ver estad√≠sticas y resumen">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-page="comunicados" aria-label="Comunicados - Ver y crear comunicados digitales">
                    <span class="nav-icon">üì¢</span>
                    <span>Comunicados</span>
                </a>
                <a href="#" class="nav-item" data-page="solicitudes" aria-label="Solicitudes - Ver y crear solicitudes">
                    <span class="nav-icon">üìù</span>
                    <span>Solicitudes</span>
                </a>
                <a href="#" class="nav-item" data-page="admin-panel" id="admin-link" style="display: none;" aria-label="Panel Administrativo - Gestionar solicitudes y administrar el sistema">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>Panel Admin</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="main-content" role="main">
            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page" style="display: none;">
                <h2>Dashboard</h2>
                <div class="stats-grid" id="stats-grid">
                    <!-- Stats will be loaded dynamically -->
                </div>
            </div>

            <!-- Comunicados Page -->
            <div id="page-comunicados" class="page" style="display: none;">
                <div class="page-header">
                    <h2>Comunicados Digitales</h2>
                    <div style="display: flex; gap: var(--spacing-3); align-items: center;">
                        <div class="export-actions">
                            <button class="export-btn pdf" onclick="window.app?.exportComunicadosPDF()" title="Exportar todos a PDF">
                                üìÑ PDF
                            </button>
                            <button class="export-btn excel" onclick="window.app?.exportComunicadosExcel()" title="Exportar a Excel">
                                üìä Excel
                            </button>
                        </div>
                        <button id="btn-new-comunicado" class="btn btn-primary" title="Crear un nuevo comunicado digital" aria-label="Crear nuevo comunicado">Nuevo Comunicado</button>
                    </div>
                </div>
                <div class="filters-bar">
                    <div class="search-wrapper">
                        <input type="text" id="search-comunicados" placeholder="Buscar comunicados..." class="search-input">
                        <span class="search-icon">üîç</span>
                    </div>
                    <select id="filter-departamento" class="filter-select" title="Filtrar por departamento">
                        <option value="">Todos los departamentos</option>
                    </select>
                    <select id="filter-tipo" class="filter-select" title="Filtrar por tipo">
                        <option value="">Todos los tipos</option>
                        <option value="interno">Interno</option>
                        <option value="externo">Externo</option>
                    </select>
                </div>
                <div id="comunicados-list" class="comunicados-list">
                    <!-- Comunicados will be loaded dynamically -->
                </div>
            </div>

            <!-- Solicitudes Page -->
            <div id="page-solicitudes" class="page" style="display: none;">
                <div class="page-header">
                    <h2>Mis Solicitudes</h2>
                    <button id="btn-new-solicitud" class="btn btn-primary" title="Crear una nueva solicitud de permisos, vacaciones u otra" aria-label="Crear nueva solicitud">Nueva Solicitud</button>
                </div>
                <div id="solicitudes-stats-container" class="solicitudes-stats-container"></div>
                <div class="view-toggle-buttons" style="display: flex; gap: var(--spacing-2); margin: var(--spacing-4) 0;">
                    <button class="btn btn-sm btn-secondary view-toggle-btn active" data-view="list" onclick="window.app.toggleSolicitudesView('list')">
                        üìã Lista
                    </button>
                    <button class="btn btn-sm btn-secondary view-toggle-btn" data-view="timeline" onclick="window.app.toggleSolicitudesView('timeline')">
                        üìÖ Timeline
                    </button>
                    <button class="btn btn-sm btn-secondary view-toggle-btn" data-view="calendar" onclick="window.app.toggleSolicitudesView('calendar')">
                        üìÜ Calendario
                    </button>
                </div>
                <div class="filters-bar" id="solicitudes-filters-bar" style="display: none;">
                    <select id="solicitudes-filter-estado" class="filter-select">
                        <option value="">Todos los estados</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="aprobada">Aprobada</option>
                        <option value="rechazada">Rechazada</option>
                        <option value="en_revision">En Revisi√≥n</option>
                    </select>
                    <select id="solicitudes-filter-tipo" class="filter-select">
                        <option value="">Todos los tipos</option>
                        <option value="permiso">Permiso</option>
                        <option value="vacaciones">Vacaciones</option>
                        <option value="otra">Otra</option>
                    </select>
                    <input type="date" id="solicitudes-filter-fecha-inicio" class="filter-input" placeholder="Fecha inicio">
                    <input type="date" id="solicitudes-filter-fecha-fin" class="filter-input" placeholder="Fecha fin">
                </div>
                <div id="solicitudes-list" class="solicitudes-list">
                    <!-- Solicitudes will be loaded dynamically -->
                </div>
                <div id="solicitudes-timeline" class="solicitudes-timeline" style="display: none;">
                    <!-- Timeline view will be loaded dynamically -->
                </div>
                <div id="solicitudes-calendar" class="solicitudes-calendar" style="display: none;">
                    <!-- Calendar view will be loaded dynamically -->
                </div>
            </div>

            <!-- Admin Panel Page -->
            <div id="page-admin-panel" class="page" style="display: none;">
                <div class="page-header">
                    <h2>Panel Administrativo</h2>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <button class="btn btn-primary" id="btn-nuevo-empleado" title="Agregar nuevo empleado">
                            ‚ûï Nuevo Empleado
                        </button>
                        <div class="export-actions">
                            <button class="export-btn pdf" onclick="window.app?.exportSolicitudesPDF()" title="Exportar todas las solicitudes a PDF">
                                üìÑ PDF
                            </button>
                            <button class="export-btn excel" onclick="window.app?.exportSolicitudesExcel()" title="Exportar solicitudes a Excel">
                                üìä Excel
                            </button>
                        </div>
                    </div>
                </div>
                <div class="admin-tabs" style="margin-bottom: 1.5rem; border-bottom: 2px solid var(--border-color);">
                    <button class="admin-tab active" data-tab="solicitudes">Solicitudes</button>
                    <button class="admin-tab" data-tab="empleados">Empleados</button>
                </div>
                <div id="admin-tab-solicitudes" class="admin-tab-content">
                    <div class="admin-dashboard">
                        <div class="stats-grid" id="admin-stats">
                            <!-- Admin stats will be loaded dynamically -->
                        </div>
                        <div class="filters-bar">
                            <select id="admin-filter-departamento" class="filter-select">
                                <option value="">Todos los departamentos</option>
                            </select>
                            <select id="admin-filter-tipo" class="filter-select">
                                <option value="">Todos los tipos</option>
                                <option value="permiso">Permiso</option>
                                <option value="vacaciones">Vacaciones</option>
                                <option value="otra">Otra</option>
                            </select>
                            <input type="date" id="admin-filter-fecha-inicio" class="filter-input">
                            <input type="date" id="admin-filter-fecha-fin" class="filter-input">
                            <div class="search-wrapper">
                                <input type="text" id="admin-search-empleado" placeholder="Buscar empleado..." class="search-input">
                                <span class="search-icon">üîç</span>
                            </div>
                        </div>
                        <div id="admin-solicitudes-list" class="admin-solicitudes-list">
                            <!-- Admin solicitudes will be loaded dynamically -->
                        </div>
                    </div>
                </div>
                <div id="admin-tab-empleados" class="admin-tab-content" style="display: none;">
                    <div id="empleados-list" class="empleados-list">
                        <!-- Lista de empleados se cargar√° aqu√≠ -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="keyboard-shortcuts-modal" class="keyboard-shortcuts-modal">
        <div class="keyboard-shortcuts-content">
            <h3>‚å®Ô∏è Atajos de Teclado</h3>
            <div id="shortcuts-list">
                <!-- Shortcuts will be loaded dynamically -->
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-primary" onclick="document.getElementById('keyboard-shortcuts-modal').classList.remove('active')">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Modal: Nuevo Comunicado -->
    <div id="modal-comunicado" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Comunicado</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="form-comunicado" class="form-container">
                <div class="form-group">
                    <label for="comunicado-departamento">Departamento <span class="required-indicator">*</span></label>
                    <select id="comunicado-departamento" required aria-label="Seleccione el departamento">
                        <option value="">Seleccione...</option>
                    </select>
                </div>
                <div class="form-group" id="comunicado-categoria-group" style="display: none;">
                    <label for="comunicado-categoria">Categor√≠a <span class="required-indicator">*</span></label>
                    <select id="comunicado-categoria" aria-label="Seleccione la categor√≠a">
                        <option value="">Seleccione...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="comunicado-tipo">Tipo <span class="required-indicator">*</span></label>
                    <select id="comunicado-tipo" required aria-label="Seleccione el tipo de comunicado">
                        <option value="">Seleccione...</option>
                        <option value="interno">Interno</option>
                        <option value="externo">Externo</option>
                    </select>
                </div>
                <div class="form-group" id="comunicado-subcategoria-container" style="display: none;">
                    <label for="comunicado-subcategoria">Subcategor√≠a <span class="required-indicator">*</span></label>
                    <select id="comunicado-subcategoria" aria-label="Seleccione la subcategor√≠a">
                        <option value="">Seleccione...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="comunicado-para">Para <span class="required-indicator">*</span></label>
                    <input type="text" id="comunicado-para" required placeholder="Ej: Personal de Consulta Externa" minlength="3">
                </div>
                <div class="form-group">
                    <label for="comunicado-de">De <span class="required-indicator">*</span></label>
                    <input type="text" id="comunicado-de" required placeholder="Ej: Direcci√≥n Administrativa" minlength="3">
                </div>
                <div class="form-group">
                    <label for="comunicado-asunto">Asunto <span class="required-indicator">*</span></label>
                    <input type="text" id="comunicado-asunto" required placeholder="Ej: Notificaci√≥n sobre cobros a colaboradores" minlength="3">
                </div>
                <div class="form-group">
                    <label for="comunicado-contenido">
                        Contenido <span class="required-indicator">*</span>
                        <span id="comunicado-paginas-estimadas" class="paginas-estimadas" style="display: none;">
                            (Aprox. <span id="comunicado-num-paginas">1</span> p√°gina)
                        </span>
                    </label>
                    <textarea id="comunicado-contenido" rows="10" required placeholder="Escriba el contenido del comunicado...&#10;&#10;Nota: El sistema dividir√° autom√°ticamente el contenido en m√∫ltiples p√°ginas si es muy largo." minlength="10"></textarea>
                    <small class="form-hint">Escribe el contenido completo. El sistema calcular√° autom√°ticamente cu√°ntas p√°ginas tendr√° el PDF.</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary modal-close">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Crear Comunicado</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Ver Comunicado -->
    <div id="modal-ver-comunicado" class="modal">
        <div class="modal-content modal-content-large">
            <div class="modal-header">
                <h3>Comunicado</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div id="comunicado-documento" class="comunicado-documento">
                <!-- El contenido se cargar√° din√°micamente -->
            </div>
            <div class="modal-footer" style="padding: 1rem; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 1rem;">
                <button type="button" class="btn btn-secondary modal-close">Cerrar</button>
                <button type="button" class="btn btn-secondary" id="btn-firmas-comunicado">Firmas</button>
                <button type="button" class="btn btn-primary" id="btn-export-comunicado-detalle">Exportar PDF</button>
            </div>
        </div>
    </div>

    <!-- Modal: Firmas de Comunicado -->
    <div id="modal-firmas-comunicado" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Firmas del Comunicado</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" style="padding: 1.5rem;">
                <div id="firmas-comunicado-lista" style="max-height: 500px; overflow-y: auto;">
                    <!-- Lista de empleados se cargar√° aqu√≠ -->
                </div>
                <div id="firmar-comunicado-form" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                    <h4 style="margin-bottom: 1rem;">Firmar con c√≥digo personal</h4>
                    <div class="form-group">
                        <label for="codigo-firma-personal">C√≥digo Personal <span class="required-indicator">*</span></label>
                        <input type="text" id="codigo-firma-personal" placeholder="Ingrese su c√≥digo personal" style="text-transform: uppercase;" oninput="this.value = this.value.toUpperCase()">
                    </div>
                    <button type="button" class="btn btn-primary" id="btn-firmar-comunicado">Firmar</button>
                </div>
            </div>
            <div class="modal-footer" style="padding: 1rem; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 1rem;">
                <button type="button" class="btn btn-secondary modal-close">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal: Nuevo Empleado -->
    <div id="modal-nuevo-empleado" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Empleado</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="form-empleado" class="form-container">
                <div class="form-group">
                    <label for="empleado-nombre">Nombre Completo <span class="required-indicator">*</span></label>
                    <input type="text" id="empleado-nombre" required placeholder="Ej: Juan P√©rez" minlength="3">
                </div>
                <div class="form-group">
                    <label for="empleado-email">Email <span class="required-indicator">*</span></label>
                    <input type="email" id="empleado-email" required placeholder="empleado@empresa.com">
                </div>
                <div class="form-group">
                    <label for="empleado-departamento">Departamento <span class="required-indicator">*</span></label>
                    <select id="empleado-departamento" required>
                        <option value="">Seleccione...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="empleado-codigo-personal">C√≥digo Personal</label>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <input type="text" id="empleado-codigo-personal" readonly style="flex: 1; background: #f3f4f6; font-weight: 600; letter-spacing: 2px; text-align: center; font-size: 1.125rem;">
                        <button type="button" class="btn btn-secondary" id="btn-generar-codigo" title="Generar nuevo c√≥digo">üîÑ Generar</button>
                    </div>
                    <small class="form-hint">Este c√≥digo se generar√° autom√°ticamente y ser√° usado para firmar comunicados.</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary modal-close">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Crear Empleado</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Nueva Solicitud -->
    <div id="modal-solicitud" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva Solicitud</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="form-solicitud" class="form-container">
                <div class="form-group">
                    <label for="solicitud-tipo">Tipo de Solicitud *</label>
                    <select id="solicitud-tipo" required>
                        <option value="">Seleccione...</option>
                        <option value="permiso">Permiso sin goce de salario</option>
                        <option value="vacaciones">Vacaciones</option>
                        <option value="otra">Otra solicitud</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="solicitud-departamento">Departamento *</label>
                    <select id="solicitud-departamento" required>
                        <option value="">Seleccione...</option>
                    </select>
                </div>
                <div id="solicitud-fields">
                    <!-- Dynamic fields based on type -->
                </div>
                <div class="form-group">
                    <label>Firma Digital del Empleado *</label>
                    <div class="signature-container">
                        <canvas id="signature-canvas-solicitud" width="500" height="200"></canvas>
                        <div class="signature-actions">
                            <button type="button" id="clear-signature-solicitud" class="btn btn-secondary">Limpiar Firma</button>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary modal-close">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Enviar Solicitud</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Detalle Solicitud (Admin) -->
    <div id="modal-solicitud-detalle" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Detalle de Solicitud</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div id="solicitud-detalle-content" class="solicitud-detalle">
                <!-- Solicitud details will be loaded dynamically -->
            </div>
            <div class="admin-actions" id="admin-actions" style="display: none;">
                <div class="form-group">
                    <label for="justificacion">Justificaci√≥n (requerida para rechazo)</label>
                    <textarea id="justificacion" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Firma Digital *</label>
                    <div class="signature-container">
                        <canvas id="signature-canvas" width="500" height="200"></canvas>
                        <div class="signature-actions">
                            <button type="button" id="clear-signature" class="btn btn-secondary">Limpiar</button>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="window.app.exportSolicitudPDF(window.app.currentSolicitudId)" title="Exportar a PDF">
                        üìÑ Exportar PDF
                    </button>
                    <button type="button" id="btn-aprobar" class="btn btn-success">Aprobar</button>
                    <button type="button" id="btn-rechazar" class="btn btn-danger">Rechazar</button>
                    <button type="button" id="btn-revision" class="btn btn-warning">Marcar en Revisi√≥n</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/database.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/forms.js"></script>
    <script type="module" src="js/signature.js"></script>
    <script type="module" src="js/notifications.js"></script>
    <!-- Dark mode disabled - using light mode only -->
    <script type="module" src="js/keyboard-shortcuts.js"></script>
    <script type="module" src="js/charts.js"></script>
    <script type="module" src="js/vacation-calendar.js"></script>
    <script type="module" src="js/templates.js"></script>
    <script type="module" src="js/export.js"></script>
    <script type="module" src="js/quick-actions.js"></script>
    <script type="module" src="js/reminders.js"></script>
    <script type="module" src="js/solicitudes-enhancements.js"></script>
    <script type="module" src="js/solicitudes-timeline.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>

